===============================================================================
マルチタスクストップウォッチ 取扱説明書 
===============================================================================

【１．概要】
--------------------------------------------------
- 本アプリは、複数タスクを同時管理する「マルチタスクストップウォッチ」です。
- カテゴリごとにタスクをグループ化し、ドラッグ＆ドロップで並べ替えや移動が可能。
- カテゴリ名の変更は「ヘッダーのカテゴリ名をダブルクリック」で編集できます（すべてのタスクが一括でカテゴリ移動）。
- カテゴリには「合計時間」を表示し、折りたたみしても実行中のタスクは計測が止まりません。
- タスクカードにはカテゴリ入力欄を設けず、カテゴリ操作はヘッダーで統一。
- 「手動で保存」ボタン（画面右上）や自動保存により、ローカルストレージで状態を保持。
- ブラウザを閉じるときに動作中のタイマーは自動停止して保存され、次回に同じ状態を復元します。

【２．画面構成】
--------------------------------------------------
1) 上部コントロールパネル
   - 「カテゴリー」「タスク名」入力欄で新規タスクを追加。
   - 「＋タスク追加」ボタンを押すと、そのカテゴリに新しいタスクが作られる。
   - 「STOP ALL」ボタン: すべてのストップウォッチを停止。
   - 「RESET ALL」ボタン: すべての時間をリセット（0に）＆停止。

2) 右上「手動で保存」ボタン
   - 画面（ウィンドウ）右上端に固定表示。
   - 操作後は通常自動保存されるが、必要に応じてここを押すことで明示的に保存が可能。

3) 下部の「カテゴリカード」一覧
   - カテゴリごとにカードが縦に並ぶ。ドラッグ＆ドロップで上下順を変更可。
   - 各カテゴリカードのヘッダーと、内部の「タスクカード」一覧に分かれる。

【３．カテゴリカードのヘッダー】
--------------------------------------------------
- 三本線「≡」: 掴んでドラッグするとカテゴリカード自体を上下に並び替え。
- 折りたたみボタン「▼ / ▶」: カテゴリを折りたたみ or 展開してタスク一覧を隠す/表示する。
- カテゴリ名（ダブルクリックで編集）:
  - 通常は文字列を表示。ダブルクリックすると編集モードになり、新しい文字列を確定すると
    そのカテゴリに属するすべてのタスクが一括で移動（=カテゴリ名の置換）。
- カラー選択「Color」ボタン: カラーパレットを開き、クリックした色でヘッダー＆タスクカードの背景を変更。
- 「＋」ボタン: そのカテゴリ内にタスクを新規追加（「New Task」という名前のタスクが1つ作られる）。
- 合計時間表示「合計時間: mm:ss.xxx」:
  - カテゴリ内のタスクすべての時間を合計し表示。折りたたみ中でも計算は続行され、実行中タスクがあれば数値は増加。

【４．タスクカードの構成】
--------------------------------------------------
- 三本線「≡」: 左端にあり、掴んでドラッグすると同じカテゴリ内で上下移動、他カテゴリへ移動も可能。
- タスク名（テキスト入力欄）:
  - 作成時「New Task」や上部入力欄で指定された名前が設定される。
  - 直接編集すれば変更できる（自動保存）。
- 時間表示 (mm:ss.xxx):
  - START中ならリアルタイムで増加、STOPなら停止。
- 操作ボタン:
  - START/STOP: 実行と停止を切り替え（STARTは青ボタン、STOPは赤ボタン）。
  - RESET: そのタスクの時間を0にして停止状態に。
  - 削除: そのタスクを完全に消す。

【５．ドラッグ＆ドロップ操作】
--------------------------------------------------
1. カテゴリ並び替え:
   - カテゴリヘッダー左端「≡」を掴んで上下へドロップ→順番を変更。
2. タスク並び替え:
   - タスクカード左端「≡」を掴んで上下へドロップ→同カテゴリ内での順番変更。
   - 他のカテゴリカードへドロップ→カテゴリをまたいだタスクの移動ができる。

【６．動作と保存】
--------------------------------------------------
1. 自動保存:
   - タスクを追加/削除/編集/ドラッグ操作/START/STOP など、状態が変化するたびに自動でローカルストレージに保存。
2. ページを閉じる:
   - 実行中のストップウォッチは自動停止→保存され、次回開くと停止状態で復元。
3. 手動で保存:
   - 右上の「手動で保存」ボタンを押すといつでも明示的に保存（お好みで利用）。
4. ローカルストレージ:
   - 同じPC・同じブラウザ環境であれば状態が保持されます。Cookieやローカルストレージをクリアするとデータが消失。

【７．折りたたみ時のタイマーについて】
--------------------------------------------------
- カテゴリを折りたたんでも、実行中のタスクはバックグラウンドで計測を続行。
- タイマー表示は折りたたまれている間は非表示だが、合計時間の数値はヘッダーに表示され更新されます。
- 再度展開すると、それまで計測していた時間が表示され、止まっていません。

【８．トラブルシューティング】
--------------------------------------------------
1. カテゴリ名を編集したが変更されない:
   - ダブルクリック後に名前を入力し、Enterキー or フォーカスを外す（blur）までが確定操作。
   - 変更すると旧カテゴリ名は新カテゴリ名に置き換えられます。
2. タスクの時間表示が止まった/バグ？
   - 折りたたみ中でも内部計測は続行されるように修正済み。再度展開すると時間が進んでいるはず。
   - もしすべてのカテゴリが折りたたまれ、かつ全タスクがSTOPなら自動的にタイマーは停止（正常動作）。
3. タスクからカテゴリを変えられない:
   - 今回の改修でタスク内のカテゴリ欄は削除。カテゴリを変更したい場合はドラッグ＆ドロップか、カテゴリ名自体を編集して全タスク移動する。
4. データが消えた:
   - ブラウザのローカルストレージをクリアするとデータが消えます。必要なら事前にバックアップやエクスポートなどを検討。

【９．まとめ】
--------------------------------------------------
- カテゴリ名はヘッダーのタイトルをダブルクリックで変更可能（すべてのタスクが連動移動）。
- カテゴリの合計時間をヘッダーに表示、折りたたみ中でも計測は続く。
- タスクカードにはカテゴリ入力欄がなく、DRAG＆DROPで他カテゴリへ移動する仕様。
- 画面右上「手動で保存」ボタンで任意に保存もできるが、通常は自動保存により常に最新状態が維持されます。

===============================================================================
