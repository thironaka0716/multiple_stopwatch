<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>Stopwatch Sample</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      margin-top: 50px;
    }
    .time-display {
      font-size: 2rem;
      margin-bottom: 20px;
    }
    button {
      margin: 5px;
      font-size: 1rem;
      padding: 10px 20px;
    }
  </style>
</head>
<body>

  <div class="time-display" id="display">00 : 00 : 000</div>
  <button id="startStopBtn">START</button>
  <button id="resetBtn">RESET</button>

  <script>
    let startTime = 0;       // 計測を開始した時刻(ミリ秒)
    let elapsedTime = 0;     // 合計経過時間(ミリ秒)
    let timerId = null;      // setIntervalのID
    let running = false;     // ストップウォッチが動作中かどうか

    const display = document.getElementById('display');
    const startStopBtn = document.getElementById('startStopBtn');
    const resetBtn = document.getElementById('resetBtn');

    // 時刻表示を更新する関数
    function updateTime() {
      // 現在時刻との差分(ミリ秒)
      const now = Date.now();
      const diff = now - startTime;
      // 現在の合計経過時間（以前のelapsedTimeに差分を加える）
      const total = elapsedTime + diff;

      // ミリ秒 => 分, 秒, ミリ秒に分解
      const ms = total % 1000;               // ミリ秒
      const s = Math.floor(total / 1000) % 60; // 秒
      const m = Math.floor(total / 60000);     // 分

      // 2桁, 3桁表示用に文字列をフォーマット
      const formattedM = String(m).padStart(2, '0');
      const formattedS = String(s).padStart(2, '0');
      const formattedMs = String(ms).padStart(3, '0');

      // HTMLに反映
      display.textContent = `${formattedM} : ${formattedS} : ${formattedMs}`;
    }

    // ストップウォッチをスタートまたはストップする処理
    function startStop() {
      if (!running) {
        // 停止中の場合はスタートする
        running = true;
        startStopBtn.textContent = 'STOP';

        // 現在時刻からスタートする
        startTime = Date.now();
        // 一定間隔で時間表示を更新
        timerId = setInterval(updateTime, 10);

      } else {
        // 動作中の場合はストップする
        running = false;
        startStopBtn.textContent = 'START';

        // タイマーを止めて、経過時間を更新
        clearInterval(timerId);
        timerId = null;

        // 最後にupdateTimeを呼んで最新状態にしてからelapsedTimeを上書き
        updateTime();
        // stopした時点での経過時間 totalを算出
        const now = Date.now();
        elapsedTime += (now - startTime);
      }
    }

    // リセット処理
    function reset() {
      // タイマーを止める
      if (timerId) {
        clearInterval(timerId);
        timerId = null;
      }
      running = false;
      startStopBtn.textContent = 'START';

      // 経過時間を0にして表示をリセット
      startTime = 0;
      elapsedTime = 0;
      display.textContent = '00 : 00 : 000';
    }

    // ボタンのイベント設定
    startStopBtn.addEventListener('click', startStop);
    resetBtn.addEventListener('click', reset);
  </script>
</body>
</html>
